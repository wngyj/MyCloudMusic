<!DOCTYPE html>
<html>
<head>
    <title>ç½‘æ˜“äº‘éŸ³ä¹æç®€ç‰ˆ</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #f8f9fa; margin: 0; padding: 15px; }
        .search-box { position: sticky; top: 0; background: #f8f9fa; padding: 10px 0; display: flex; gap: 5px; z-index: 100; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        button.search-btn { padding: 10px 20px; background: #ff3a3a; color: white; border: none; border-radius: 8px; font-weight: bold; }
        
        .song-item { background: white; margin-top: 10px; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .song-info { flex: 1; margin-right: 10px; overflow: hidden; }
        .song-name { font-weight: bold; color: #333; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-artist { font-size: 0.85em; color: #666; margin-top: 4px; }
        
        .btn-group { display: flex; gap: 5px; }
        .play-btn { background: #4caf50; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8em; }
        .dl-btn { background: #2196f3; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8em; }
        
        #player-container { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        audio { width: 100%; height: 40px; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="keyword" placeholder="è¾“å…¥æ­Œåæˆ–æ­Œæ‰‹" onkeypress="if(event.keyCode==13) search()">
        <button class="search-btn" onclick="search()">æœç´¢</button>
    </div>

    <div id="result-list" style="padding-bottom: 120px;">
        <p style="text-align:center; color:#999; margin-top:30px;">æ­£åœ¨ä½¿ç”¨å…¬ç½‘ API ç‹¬ç«‹è¿è¡Œ</p>
    </div>

    <div id="player-container">
        <div id="now-playing" style="font-size: 0.85em; margin-bottom: 8px; color: #333; text-align: center; font-weight: bold;">æœªåœ¨æ’­æ”¾</div>
        <audio id="mainPlayer" controls></audio>
    </div>

    <script>
        /** * è¿™é‡Œæ˜¯æ ¸å¿ƒä¿®æ”¹ï¼š
         * å¦‚æœä½ æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼ŒæŠŠä¸‹é¢çš„åœ°å€æ¢æˆä½ çš„ã€‚
         * å¦‚æœæ²¡æœ‰ï¼Œå…ˆç”¨è¿™ä¸ª Demo åœ°å€æµ‹è¯•æ‰“åŒ…æ•ˆæœã€‚
         **/
        const API_URL = 'https://netease-cloud-music-api-demo.vercel.app'; 

        async function search() {
            const kw = document.getElementById('keyword').value;
            if(!kw) return;
            const listDiv = document.getElementById('result-list');
            listDiv.innerHTML = '<p style="text-align:center">ğŸ” æœç´¢ä¸­...</p>';

            try {
                // ä½¿ç”¨åŠ¨æ€ API åœ°å€
                const res = await fetch(`${API_URL}/search?keywords=${encodeURIComponent(kw)}`);
                const data = await res.json();
                
                const songs = data.result?.songs || data.data?.songs || [];
                
                if (songs.length === 0) {
                    listDiv.innerHTML = '<p style="text-align:center">âŒ æœªæ‰¾åˆ°ç»“æœ</p>';
                    return;
                }
                
                listDiv.innerHTML = ''; 
                songs.forEach(song => {
                    const artistsArr = song.ar || song.artists || [{name: 'æœªçŸ¥'}];
                    const artists = artistsArr.map(a => a.name).join(' / ');
                    const safeName = song.name.replace(/'/g, "\\'");

                    const item = document.createElement('div');
                    item.className = 'song-item';
                    item.innerHTML = `
                        <div class="song-info">
                            <span class="song-name">${song.name}</span>
                            <span class="song-artist">${artists}</span>
                        </div>
                        <div class="btn-group">
                            <button class="play-btn" onclick="getAndAction(${song.id}, '${safeName}', 'play')">æ’­æ”¾</button>
                            <button class="dl-btn" onclick="getAndAction(${song.id}, '${safeName}', 'download')">ä¸‹è½½</button>
                        </div>
                    `;
                    listDiv.appendChild(item);
                });
            } catch (e) {
                listDiv.innerHTML = '<p style="text-align:center; color:red;">API è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</p>';
            }
        }

        async function getAndAction(id, name, type) {
            try {
                // ä½¿ç”¨åŠ¨æ€ API åœ°å€
                const res = await fetch(`${API_URL}/song/url/v1?id=${id}&level=standard`);
                const data = await res.json();
                const url = data.data?.[0]?.url;

                if(!url) {
                    alert('æŠ±æ­‰ï¼Œæ­¤æ­Œæ›²å¯èƒ½å—ç‰ˆæƒä¿æŠ¤ï¼Œæ— æ³•è·å–åœ°å€');
                    return;
                }

                if(type === 'play') {
                    const player = document.getElementById('mainPlayer');
                    document.getElementById('now-playing').innerText = 'æ­£åœ¨æ’­æ”¾: ' + name;
                    player.src = url;
                    player.play();
                } else {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = name + ".mp3";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }
            } catch (e) {
                alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
    </script>
</body>
</html>
