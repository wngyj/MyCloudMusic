<!DOCTYPE html>
<html>
<head>
    <title>ç½‘æ˜“äº‘éŸ³ä¹-æœ¬åœ°è”åŠ¨ç‰ˆ</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #f8f9fa; margin: 0; padding: 15px; }
        .search-box { position: sticky; top: 0; background: #f8f9fa; padding: 10px 0; display: flex; gap: 5px; z-index: 100; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        button.search-btn { padding: 10px 20px; background: #ff3a3a; color: white; border: none; border-radius: 8px; font-weight: bold; }
        .song-item { background: white; margin-top: 10px; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .song-info { flex: 1; margin-right: 10px; overflow: hidden; }
        .song-name { font-weight: bold; color: #333; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-artist { font-size: 0.85em; color: #666; margin-top: 4px; }
        .play-btn { background: #4caf50; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 0.8em; }
        #player-container { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        audio { width: 100%; height: 40px; }
        .termux-notice { background: #fee; border: 1px solid #fcc; padding: 15px; border-radius: 10px; text-align: center; margin-top: 20px; }
        .termux-btn { background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="keyword" placeholder="æœç´¢æœ¬åœ° Termux éŸ³ä¹åº“">
        <button class="search-btn" onclick="search()">æœç´¢</button>
    </div>

    <div id="result-list" style="padding-bottom: 120px;">
        <p style="text-align:center; color:#999; margin-top:30px;">è¯·ç¡®ä¿ Termux å·²å¯åŠ¨ API æœåŠ¡</p>
    </div>

    <div id="player-container">
        <div id="now-playing" style="font-size: 0.85em; margin-bottom: 8px; color: #333; text-align: center; font-weight: bold;">å°±ç»ª</div>
        <audio id="mainPlayer" controls></audio>
    </div>

    <script>
        // æŒ‡å‘æœ¬åœ° Termux åœ°å€
        const API_URL = 'http://127.0.0.1:3000'; 
        const START_CMD = "node ~/netease-cloud-music-api/app.js";

        async function startTermux() {
            try {
                await navigator.clipboard.writeText(START_CMD);
                alert("å¯åŠ¨æŒ‡ä»¤å·²å¤åˆ¶ï¼å³å°†æ‰“å¼€ Termuxï¼Œè¯·åœ¨é‡Œé¢é•¿æŒ‰ç²˜è´´å¹¶å›è½¦ã€‚");
                // å”¤èµ· Termux çš„ Intent
                window.location.href = "intent://#Intent;launchFlags=0x10000000;component=com.termux/.MainActivity;end";
            } catch (e) {
                alert("è·³è½¬å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¯åŠ¨ Termux");
            }
        }

        async function search() {
            const kw = document.getElementById('keyword').value;
            if(!kw) return;
            const listDiv = document.getElementById('result-list');
            listDiv.innerHTML = '<p style="text-align:center">ğŸ” æ­£åœ¨è¿æ¥ Termux...</p>';

            try {
                const res = await fetch(`${API_URL}/search?keywords=${encodeURIComponent(kw)}`);
                const data = await res.json();
                const songs = data.result?.songs || [];
                
                if (songs.length === 0) {
                    listDiv.innerHTML = '<p style="text-align:center">âŒ æœªæ‰¾åˆ°æ­Œæ›²</p>';
                    return;
                }
                
                listDiv.innerHTML = ''; 
                songs.forEach(song => {
                    const artists = (song.ar || song.artists || []).map(a => a.name).join('/');
                    const item = document.createElement('div');
                    item.className = 'song-item';
                    item.innerHTML = `
                        <div class="song-info">
                            <span class="song-name">${song.name}</span>
                            <span class="song-artist">${artists}</span>
                        </div>
                        <button class="play-btn" onclick="playSong(${song.id}, '${song.name.replace(/'/g, "\\'")}')">æ’­æ”¾</button>
                    `;
                    listDiv.appendChild(item);
                });
            } catch (e) {
                listDiv.innerHTML = `
                    <div class="termux-notice">
                        <p style="color:#d32f2f;font-weight:bold;">æ— æ³•è¿æ¥åˆ° Termux æœåŠ¡</p>
                        <p style="font-size:0.85em;color:#666;">è¯·ç¡®è®¤ API å·²åœ¨åå°è¿è¡Œ</p>
                        <button class="termux-btn" onclick="startTermux()">ç‚¹å‡»å¤åˆ¶æŒ‡ä»¤å¹¶æ‰“å¼€ Termux</button>
                    </div>`;
            }
        }

        async function playSong(id, name) {
            try {
                const res = await fetch(`${API_URL}/song/url/v1?id=${id}&level=standard`);
                const data = await res.json();
                const url = data.data?.[0]?.url;
                if(url) {
                    const player = document.getElementById('mainPlayer');
                    document.getElementById('now-playing').innerText = 'æ­£åœ¨æ’­æ”¾: ' + name;
                    player.src = url;
                    player.play();
                }
            } catch (e) {
                alert('è·å–æ’­æ”¾åœ°å€å¤±è´¥');
            }
        }
    </script>
</body>
</html>
